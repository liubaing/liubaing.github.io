<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[六八ing的博客]]></title>
  <subtitle><![CDATA[各种扯淡]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://liubaing.com/"/>
  <updated>2014-06-27T09:14:11.093Z</updated>
  <id>http://liubaing.com/</id>
  
  <author>
    <name><![CDATA[何帅]]></name>
    <email><![CDATA[liubaing@gmail.com]]></email>
  </author>
  
  <generator uri="http://zespia.tw/hexo/">Hexo</generator>
  
  <entry>
    <title><![CDATA[URL编码]]></title>
    <link href="http://liubaing.com/2014/06/27/URL%E7%BC%96%E7%A0%81/"/>
    <id>http://liubaing.com/2014/06/27/URL编码/</id>
    <published>2014-06-27T07:42:03.000Z</published>
    <updated>2014-06-27T09:14:04.000Z</updated>
    <content type="html"><![CDATA[<p>前段时间有个世界杯的需求，增加世界杯外链统计。当时直接把合作方链接作为参数放在URL中，上线后相安无事。<br>但最近运营同事修改链接后，发现跳转不正确，反馈过来后，我赶紧用Chrome的调试工具观察Network，原来是外链中包含<code>&amp;word=爸爸去哪儿</code>参数，而之前并没有对外链进行编码，导致外链的参数被当作统计URL的参数了，所以外链参数丢失，跳转不正确。</p>
<a id="more"></a>

<p>知道原因后，在前端JS中增加<code>encodeURIComponent()</code>，本地测试感觉良好，跟运营同事沟通后，他测试还是跳转不正确，这次再调试，又疏忽大意了，本地是Tomcat7，而线上是Tomcat8。</p>
<p>去Tomcat官网看了 <a href="http://tomcat.apache.org/tomcat-8.0-doc/changelog.html" target="_blank" rel="external">Tomcat 8 changelog</a>，注意下面这句话<br><code>Change the default URIEncoding for all connectors from ISO-8859-1 to UTF-8</code></p>
<p>在Controller中对链接进行编码处理：</p>
<figure class="highlight {java}"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre>UriComponentsBuilder urlBuilder = UriComponentsBuilder<span class="preprocessor">.fromHttpUrl</span>(link)<span class="comment">;</span>
MultiValueMap&lt;String, String&gt; params = urlBuilder<span class="preprocessor">.build</span>()<span class="preprocessor">.getQueryParams</span>()<span class="comment">;</span>
if (!params<span class="preprocessor">.isEmpty</span>()) {
    StringBuilder queryBuilder = new StringBuilder()<span class="comment">;</span>
    for (Map<span class="preprocessor">.Entry</span>&lt;String, List&lt;String&gt;&gt; entry : params<span class="preprocessor">.entrySet</span>()) {
        String name = entry<span class="preprocessor">.getKey</span>()<span class="comment">;</span>
        List&lt;String&gt; values = entry<span class="preprocessor">.getValue</span>()<span class="comment">;</span>
        if (CollectionUtils<span class="preprocessor">.isEmpty</span>(values)) {
            if (queryBuilder<span class="preprocessor">.length</span>() != <span class="number">0</span>) {
                queryBuilder<span class="preprocessor">.append</span>(<span class="string">'&'</span>)<span class="comment">;</span>
            }
            queryBuilder<span class="preprocessor">.append</span>(name)<span class="comment">;</span>
        }
        else {
            for (Object value : values) {
                if (queryBuilder<span class="preprocessor">.length</span>() != <span class="number">0</span>) {
                    queryBuilder<span class="preprocessor">.append</span>(<span class="string">'&'</span>)<span class="comment">;</span>
                }
                queryBuilder<span class="preprocessor">.append</span>(name)<span class="comment">;</span>

                if (value != null) {
                    queryBuilder<span class="preprocessor">.append</span>(<span class="string">'='</span>)<span class="comment">;</span>
                    queryBuilder<span class="preprocessor">.append</span>(EncodeUtils<span class="preprocessor">.urlEncode</span>(value<span class="preprocessor">.toString</span>()))<span class="comment">;</span>
                }
            }
        }
    }
    redirectView<span class="preprocessor">.setUrl</span>(urlBuilder<span class="preprocessor">.replaceQuery</span>(queryBuilder<span class="preprocessor">.toString</span>())<span class="preprocessor">.build</span>()<span class="preprocessor">.toUriString</span>())<span class="comment">;</span>
}
</pre></td></tr></table></figure>

<p>这下在ResponseHeader中Location字段出现中文也没问题了。</p>
]]></content>
    <summary type="html"><![CDATA[<p>前段时间有个世界杯的需求，增加世界杯外链统计。当时直接把合作方链接作为参数放在URL中，上线后相安无事。<br>但最近运营同事修改链接后，发现跳转不正确，反馈过来后，我赶紧用Chrome的调试工具观察Network，原来是外链中包含<code>&amp;word=爸爸去哪儿</code>参数，而之前并没有对外链进行编码，导致外链的参数被当作统计URL的参数了，所以外链参数丢失，跳转不正确。</p>
]]></summary>
    
      <category term="Java" scheme="http://liubaing.com/tags/Java/"/>
    
      <category term="编程" scheme="http://liubaing.com/categories/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[龙泉驾校约车脚本]]></title>
    <link href="http://liubaing.com/2014/06/18/%E9%BE%99%E6%B3%89%E9%A9%BE%E6%A0%A1%E7%BA%A6%E8%BD%A6%E8%84%9A%E6%9C%AC/"/>
    <id>http://liubaing.com/2014/06/18/龙泉驾校约车脚本/</id>
    <published>2014-06-18T08:20:49.000Z</published>
    <updated>2014-06-19T09:57:12.000Z</updated>
    <content type="html"><![CDATA[<p>最近该学科目二，可一连几天都约不上车，开始琢磨写个脚本，看有没有效果。<br><a id="more"></a></p>
<p>抱怨驾校也是徒劳，谁让当时图便宜呢。脚本也是参考了其他同学的代码，调整后不是特别完善，不过龙泉的校友还是可以参考。</p>
<p>下面是执行脚本，其中有些参数根据自己情况填写：</p>
<figure class="highlight {python}"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="code"><pre><span class="comment"># !/usr/bin/python</span>
<span class="comment"># -*- coding: utf-8 -*-</span>

<span class="keyword">import</span> lqjx
<span class="keyword">import</span> sys
<span class="keyword">import</span> time
<span class="keyword">import</span> logging

logging.basicConfig(level=logging.DEBUG,
                    format=<span class="string">'%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s'</span>,
                    datefmt=<span class="string">'%a, %d %b %Y %H:%M:%S'</span>)

<span class="comment">#约车时段，全部、上午8-12、下午1-5、晚上5-8</span>
xnsd = (<span class="string">"-1"</span>, <span class="string">"812"</span>, <span class="string">"15"</span>, <span class="string">"58"</span>)
<span class="comment">#指定想约的教练</span>
jlcbh = <span class="string">""</span>
uname = <span class="string">""</span>
passwd = <span class="string">""</span>

<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    lq = lqjx.LQJX()
    <span class="keyword">if</span> lq.login(uname, passwd):
        <span class="keyword">while</span> <span class="number">1</span>:
            cars = lq.get_bookable_car(xnsd[<span class="number">1</span>])
            <span class="keyword">if</span> <span class="string">'null_0'</span> <span class="keyword">in</span> cars:
                logging.info(<span class="string">'没到时间或者没有可预订车辆！'</span>)
            <span class="keyword">else</span>:
                result = lq.order_car(xnsd[<span class="number">1</span>], jlcbh)
                <span class="keyword">print</span> result
                <span class="keyword">if</span> <span class="string">u'成功'</span> <span class="keyword">in</span> result:
                    logging.info(<span class="string">'\n 预定成功！'</span>)
                    sys.exit(<span class="number">0</span>)
            <span class="comment">#增加间隔时间，防止频繁请求，账号被封</span>
            time.sleep(<span class="number">30</span>)
</pre></td></tr></table></figure>

<p>下面是核心模块：</p>
<figure class="highlight {python}"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre></td><td class="code"><pre><span class="comment"># -*- coding: utf-8 -*-</span>

<span class="keyword">import</span> requests
<span class="keyword">import</span> datetime
<span class="keyword">import</span> time
<span class="keyword">import</span> logging

LQJX_HOST = <span class="string">"http://106.37.230.254:81"</span>
lq_session = requests.Session()


<span class="class"><span class="keyword">class</span> <span class="title">LQJX</span>:</span>

    header = {
        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36'</span>
    }

    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span>
        <span class="keyword">pass</span>

    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self, uname, passwd)</span>:</span>
        post_data = {
            <span class="string">'__VIEWSTATE'</span>: <span class="string">'/wEPDwUKMTg0NDI4MDE5OGRkj8OrkkOlfYqdhxkeEVV4GsZ6FLw0IioIcl+nbwqoGbo='</span>,
            <span class="string">'__EVENTVALIDATION'</span>: <span class="string">'/wEWBgKF6pivDAKl1bKzCQK1qbSRCwLoyMm8DwLi44eGDAKAv7D9Co04a1vpmJ/QuWDi2GFypJ8LBXRdxHsgxKaj/eIzgMJ6'</span>,
            <span class="string">'txtUserName'</span>: uname,
            <span class="string">'txtPassword'</span>: passwd,
            <span class="string">'BtnLogin'</span>: <span class="string">'登  录'</span>,
            <span class="string">'rcode'</span>: <span class="string">''</span>
        }
        result = lq_session.post(LQJX_HOST + <span class="string">'/login.aspx'</span>, data=post_data, headers=self.header)
        <span class="keyword">if</span> <span class="string">'zhxx.aspx'</span> <span class="keyword">in</span> result.text:
            logging.info(<span class="string">"登录成功!"</span>)
            flag = <span class="keyword">True</span>
        <span class="keyword">else</span>:
            logging.error(<span class="string">"登录失败，请检查账号状态或请求参数!"</span>)
            flag = <span class="keyword">False</span>
        <span class="keyword">return</span> flag

    <span class="function"><span class="keyword">def</span> <span class="title">order_car</span><span class="params">(self, xnsd, jlcbh)</span>:</span>
        query_param = {
            <span class="string">'jlcbh'</span>: jlcbh,  <span class="comment">#教练场编号</span>
            <span class="string">'yyrqbegin'</span>: str(datetime.date.today() + datetime.timedelta(<span class="number">13</span>)).replace(<span class="string">'-'</span>, <span class="string">''</span>),  <span class="comment">#预约14天后</span>
            <span class="string">'xnsd'</span>: xnsd,  <span class="comment">#时段 -1  812  15  58</span>
            <span class="string">'trainType'</span>: <span class="string">'3'</span>,  <span class="comment">#原地1 道路3 实际4</span>
            <span class="string">'type'</span>: <span class="string">'km2Car2'</span>,  <span class="comment">#约车类型 科目二km2Car2</span>
            <span class="string">'_'</span>: int(time.time())  <span class="comment">#时间戳</span>
        }
        <span class="keyword">return</span> lq_session.get(LQJX_HOST + <span class="string">"/Tools/km2.aspx?"</span>, params=query_param, headers=self.header).text

    <span class="function"><span class="keyword">def</span> <span class="title">get_bookable_car</span><span class="params">(self, xnsd)</span>:</span>
        base_url = LQJX_HOST + <span class="string">"/Tools/km2.aspx?date="</span> + str(datetime.datetime.now())
        query_param = {
            <span class="string">'filters[yyrq]'</span>: str(datetime.date.today() + datetime.timedelta(<span class="number">13</span>)).replace(<span class="string">'-'</span>, <span class="string">''</span>),
            <span class="string">'filters[xnsd]'</span>: xnsd,
            <span class="string">'filters[xllxid]'</span>: <span class="string">'3'</span>,
            <span class="string">'filters[type]'</span>: <span class="string">'km2Car'</span>,
            <span class="string">'filters[cnbh]'</span>: <span class="string">''</span>, <span class="comment">#场内编号，不填写则为全部</span>
            <span class="string">'pageno'</span>: <span class="string">'1'</span>,
            <span class="string">'pagesize'</span>: <span class="string">'30'</span>,
            <span class="string">'_'</span>: int(time.time())
        }
        <span class="keyword">return</span> lq_session.get(base_url, params=query_param).text

<span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:
    <span class="keyword">pass</span>
</pre></td></tr></table></figure>]]></content>
    <summary type="html"><![CDATA[<p>最近该学科目二，可一连几天都约不上车，开始琢磨写个脚本，看有没有效果。<br>]]></summary>
    
      <category term="Python" scheme="http://liubaing.com/tags/Python/"/>
    
      <category term="编程" scheme="http://liubaing.com/categories/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Python规范笔记]]></title>
    <link href="http://liubaing.com/2014/06/18/Python%E8%A7%84%E8%8C%83%E7%AC%94%E8%AE%B0/"/>
    <id>http://liubaing.com/2014/06/18/Python规范笔记/</id>
    <published>2014-06-18T02:44:35.000Z</published>
    <updated>2014-06-18T08:44:03.000Z</updated>
    <content type="html"><![CDATA[<p>由于Java代码写的比较多，不由自主便将一些Java编码规范带入Python中，庆幸IDE会给出很多提示，有必要做一些总结，并且还会持续更新。<br><a id="more"></a></p>
<h5 id="1-_代码编排">1. 代码编排</h5>
<ul>
<li>不要在一行import多个库；</li>
<li>一行代码限制字符长度，过长换行；</li>
<li>类和Top-level函数定义之间空两行；</li>
<li>类中的方法定义之间空一行；</li>
<li>函数内逻辑无关段落之间空一行；</li>
<li>函数参数中KV等号两边不能加空格；</li>
<li>逗号后面和其他操作符两边要加空格；</li>
</ul>
<h5 id="2-_命名规范">2. 命名规范</h5>
<ul>
<li>模块名全部小写，可以使用<code>_</code>；</li>
<li>常量命名使用全部大写的方式，可以使用<code>_</code>；</li>
<li>类名采用大驼峰式；</li>
<li>类中函数，变量全部为小写，单词中间以<code>_</code>间隔；</li>
<li>类的方法第一个参数必须是<code>self</code>，而静态方法第一个参数必须是<code>cls</code>；</li>
</ul>
]]></content>
    <summary type="html"><![CDATA[<p>由于Java代码写的比较多，不由自主便将一些Java编码规范带入Python中，庆幸IDE会给出很多提示，有必要做一些总结，并且还会持续更新。<br>]]></summary>
    
      <category term="Python" scheme="http://liubaing.com/tags/Python/"/>
    
      <category term="编程" scheme="http://liubaing.com/categories/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[世界杯直播]]></title>
    <link href="http://liubaing.com/2014/06/15/%E4%B8%96%E7%95%8C%E6%9D%AF%E7%9B%B4%E6%92%AD/"/>
    <id>http://liubaing.com/2014/06/15/世界杯直播/</id>
    <published>2014-06-15T03:10:39.000Z</published>
    <updated>2014-06-18T02:50:05.000Z</updated>
    <content type="html"><![CDATA[<p>感谢世界杯给我们带来如此精彩的比赛，感谢CCTV节目组和解说嘉宾，更要感谢我们身边那个支持我们熬夜看球的人，但不用谢我，我只是搬运工。<br><a id="more"></a></p>
<iframe height="408" width="510" src="http://static.youku.com/v1.0.0550/v/swf/livePlayer.swf?autoplay=1&showlogo=0&channel=204" frameborder="0" allowfullscreen></iframe>

<p>今天是父亲节，在此借助世界杯祝愿天下所有父亲身体健康，感谢生命中有您的陪伴！</p>
]]></content>
    <summary type="html"><![CDATA[<p>感谢世界杯给我们带来如此精彩的比赛，感谢CCTV节目组和解说嘉宾，更要感谢我们身边那个支持我们熬夜看球的人，但不用谢我，我只是搬运工。<br>]]></summary>
    
      <category term="World Cup" scheme="http://liubaing.com/tags/World-Cup/"/>
    
      <category term="生活" scheme="http://liubaing.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[翻墙]]></title>
    <link href="http://liubaing.com/2014/06/13/%E7%BF%BB%E5%A2%99/"/>
    <id>http://liubaing.com/2014/06/13/翻墙/</id>
    <published>2014-06-13T08:38:14.000Z</published>
    <updated>2014-06-19T06:49:57.000Z</updated>
    <content type="html"><![CDATA[<p>最近Google访问不了，各种403和连接被重置。<br><a id="more"></a><br>这给平时工作带来很大的不便，至于原因大家心知肚明。</p>
<p>之前由于改过hosts，遇到Google被墙对自己影响不大，但这次彻底歇菜了。</p>
<p>选择VPN还得取决所在网络环境，L2TP方式经常连接不上，所以暂时先Pass。看微博上有推荐用SSH代理，去淘宝上搜了一家，10块一月，感觉价格可以接受，还是香港主机，下单吧。</p>
<p>跟大家分享Mac下的方法，首先打开终端输入</p>
<p><figure class="highlight {bash}"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>ssh <span class="attribute">-qTfnNv</span> <span class="attribute">-D</span> <span class="number">7070</span> username@host
</pre></td></tr></table></figure><br>输入密码后在网络设置中增加代理，这里选择SOCKS Proxy，输入127.0.0.1:7070后点击应用。</p>
<p><img src="http://liubaing.qiniudn.com/ssh_proxy.jpeg" alt="增加代理"></p>
<p>现在，打开浏览器试试吧！</p>
<hr>
<p>2014-6-19更新：<br>提供新版<a href="http://liubaing.qiniudn.com/hosts" target="_blank" rel="external">hosts</a>下载，大家自测。</p>
]]></content>
    <summary type="html"><![CDATA[<p>最近Google访问不了，各种403和连接被重置。<br>]]></summary>
    
      <category term="hosts" scheme="http://liubaing.com/tags/hosts/"/>
    
      <category term="VPN" scheme="http://liubaing.com/tags/VPN/"/>
    
      <category term="Google" scheme="http://liubaing.com/tags/Google/"/>
    
      <category term="工具" scheme="http://liubaing.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Linode退钱]]></title>
    <link href="http://liubaing.com/2014/06/12/Linode%E9%80%80%E9%92%B1/"/>
    <id>http://liubaing.com/2014/06/12/Linode退钱/</id>
    <published>2014-06-12T08:13:17.000Z</published>
    <updated>2014-06-18T09:12:44.000Z</updated>
    <content type="html"><![CDATA[<p>之前用过一段时间Linode，不过由于种种原因（其实就是懒）不想继续维护了，Remove掉主机后，它会自动结算剩余金额。也不想让钱那么寂寞的呆在账户里，琢磨怎么退还到信用卡里。<br><a id="more"></a></p>
<p>方法是登录Linode后给Linode客服发ticket申请退款。我直接写了一句 I don’t have time to maintain it and kindly need money，提交，等着收钱。然后客服回复后，退款自生成之日起，要3到5天才能到你的信用卡账户。</p>
<p>退款后，如果你觉得这个账户没有继续存在的必要，那么可以在account选项卡页面的最底部，找到“Cancel this Account”链接，点击即可。</p>
]]></content>
    <summary type="html"><![CDATA[<p>之前用过一段时间Linode，不过由于种种原因（其实就是懒）不想继续维护了，Remove掉主机后，它会自动结算剩余金额。也不想让钱那么寂寞的呆在账户里，琢磨怎么退还到信用卡里。<br>]]></summary>
    
      <category term="Linode" scheme="http://liubaing.com/tags/Linode/"/>
    
      <category term="VPS" scheme="http://liubaing.com/tags/VPS/"/>
    
      <category term="运维" scheme="http://liubaing.com/categories/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Hello World]]></title>
    <link href="http://liubaing.com/2014/06/08/hello-world/"/>
    <id>http://liubaing.com/2014/06/08/hello-world/</id>
    <published>2014-06-07T23:56:29.000Z</published>
    <updated>2014-06-13T10:08:21.000Z</updated>
    <content type="html"><![CDATA[<p>迁移到Github上，发现很多好玩的东西，比如现在用的Hexo，在写博客同时也能多了解些NodeJS。<br><a id="more"></a><br>之前零零散散也分享过，比如网易的LOFTER、开源中国，都没坚持多久就荒废了，然后在微博上偶尔也会唠叨几句自己遇到的问题，最近想着自己能把博客坚持写下去，多少也是对码农生涯一个见证。</p>
]]></content>
    <summary type="html"><![CDATA[<p>迁移到Github上，发现很多好玩的东西，比如现在用的Hexo，在写博客同时也能多了解些NodeJS。<br>]]></summary>
    
      <category term="Hexo" scheme="http://liubaing.com/tags/Hexo/"/>
    
      <category term="装B" scheme="http://liubaing.com/categories/%E8%A3%85B/"/>
    
  </entry>
  
</feed>
